#SAVE THIS!!
# these queries at the top are what I used to create the "race_enroll_analysis" table, which is the primary table
#I'm using for the school defections project analysis

create table race_enroll_analysis
select datayear, districtid, 'American Indian' as studentgroup, amIndian as Enrolled
from enroll_race_district
UNION
select datayear, districtid, 'Asian' as studentgroup, Asian as Enrolled
from enroll_race_district
UNION
select datayear, districtid, 'Black' as studentgroup, Black as Enrolled
from enroll_race_district
UNION
select datayear, districtid, 'Hispanic' as studentgroup, Hispanic as Enrolled
from enroll_race_district
UNION
select datayear, districtid, 'White' as studentgroup, White as Enrolled
from enroll_race_district

alter table race_enroll_analysis 
add column Leaving_To_Trad int,
add column Leaving_To_Charter int,
add column ComingIn INT,
add column TotalEnrolled int,
add column DistrictName varchar(255),
add column metro7county varchar(25),
add column Location varchar(50),
add column County varchar(50)


update openenroll_byrace set studentgroup=upper(studentgroup);
update race_enroll_analysis set studentgroup=upper(studentgroup)

select *
from race_enroll_analysis

select *
from leaving
where residentdistrictid='0625-01-000'

update race_enroll_analysis 
inner join leaving on trim(race_enroll_analysis.districtid)=trim(leaving.residentdistrictid)
and trim(race_enroll_analysis.datayear)=trim(leaving.datayear)
and trim(race_enroll_analysis.studentgroup)=trim(leaving.studentgroup)
set race_enroll_analysis.Leaving_To_Trad=leaving.NumLeaving where leaving.charterflag='trad'


update race_enroll_analysis 
inner join leaving on trim(race_enroll_analysis.districtid)=trim(leaving.residentdistrictid)
and trim(race_enroll_analysis.datayear)=trim(leaving.datayear)
and trim(race_enroll_analysis.studentgroup)=trim(leaving.studentgroup)
set race_enroll_analysis.Leaving_To_Charter=leaving.NumLeaving where leaving.charterflag='charter'



select b.residentdistrictid, b.datayear, a.datayear, a.districtid, a.studentgroup, a.enrolled, a.leaving_to_trad, a.leaving_to_charter, b.leavingtotrad,b.leavingtocharter
from leaving2 b left join race_enroll_analysis a on a.datayear=b.datayear and a.districtid=b.residentdistrictid
and a.studentgroup=b.studentgroup




update race_enroll_analysis 
inner join coming on trim(race_enroll_analysis.districtid)=trim(coming.districtid)
and trim(race_enroll_analysis.datayear)=trim(coming.datayear)
and trim(race_enroll_analysis.studentgroup)=trim(coming.studentgroup)
set race_enroll_analysis.ComingIn=NumComing

select distinct districtid
from race_enroll_analysis
where districtname is null

select  datayear, count(*)
from race_enroll_analysis
where districtname is null
group by datayear

select *
from race_enroll_analysis
where districtname is not null and county is null

select *
from DistrictList
where county is null

update race_enroll_analysis a
inner join enroll_race_district b on a.districtid=b.districtid and a.datayear=b.datayear
set totalenrolled=totalstudents


update race_enroll_analysis a 
inner join DistrictList b on a.districtid=b.idnumber
set a.districtname=b.organization, a.metro7county=b.metro7county, a.location=b.location,
a.county=b.county




select county, count(*)
from race_enroll_analysis
where metro7county=''
group by County

update race_enroll_analysis set metro7county='no' where metro7county=''

select county, count(*)
from race_enroll_analysis
where metro7county is null
group by County 

update race_enroll_analysis set metro7county='yes' where (county='Dakota' or county='Scott') and metro7county is NULL;
update race_enroll_analysis set metro7county='no' where county='Stearns' and metro7county is null;

delete
from race_enroll_analysis
where districtid LIKE '%-07-%'


select *
from mca
where districtname like 'ELGIN%'

delete
from race_enroll_analysis
where districtname is null

select districtname, count(*)
from race_enroll_analysis
where metro7county is null
group by districtname

update race_enroll_analysis set metro7county='no' where metro7county is null


delete
from race_enroll_analysis
where districtid like '%-53-%' or districtid like '%-62-%' or districtid like '%-52-%' or districtid like '%-06-%'

select mid(districtid, 6,2), count(*)
from race_enroll_analysis
group by mid(districtid,6,2)

delete
from race_enroll_analysis
where mid(districtid,6,2)='08' or mid(districtid,6,2)='50' or mid(districtid,6,2)='51'
or mid(districtid,6,2)='60' or mid(districtid,6,2)='61' or mid(districtid,6,2)='70' 
or mid(districtid,6,2)='83'

select datayear, studentgroup, location, sum(enrolled) as RaceTotalEnrolled, sum(Leaving_To_Trad) as leavingTrad,
sum(Leaving_To_Charter) as LeavingCharter, sum(ComingIn) as coming
from race_enroll_analysis
group by datayear, studentgroup, location

select *
from race_enroll_analysis
where county is null

update race_enroll_analysis set location='OUT STATE' where location is NULL

select location, count(*)
from race_enroll_analysis
group by location


SELECT  districtid, sum(enrolled) as RaceTotalEnrolled, sum(Leaving_To_Trad) as leavingTrad,
sum(Leaving_To_Charter) as LeavingCharter, sum(ComingIn) as coming
FROM race_enroll_analysis
where datayear='16-17'
group by  districtid

select *
from race_enroll_analysis
where districtid='0108-01-000' and datayear='16-17'

select datayear, count(*)
from race_enroll_analysis
group by datayear

select studentgroup, count(*)
from race_enroll_analysis
group by studentgroup

create view temp_countrecords
as
select districtid, count(*) as NumRecords
from race_enroll_analysis
group by districtid
having count(*)<90


select a.districtid, count(*)
from race_enroll_analysis a inner join temp_countrecords b on a.districtid=b.districtid
group by a.districtid
order by 2

select *
from race_enroll_analysis
where districtid='2758-01-000'


select datayear, count(*)
from race_enroll_analysis
where districtid='0297-01-000'
group by datayear
order by 1

select datayear, count(*)
from enroll_race_district
group by datayear

select *
from enroll_race_district
where districtname like 'minneapolis%' and datayear='16-17'


select DISTRICTID, DISTRICTNAME, LOCATION, datayear, studentgroup,  sum(enrolled) as RaceTotalEnrolled, sum(Leaving_To_Trad) as leavingTrad,
sum(Leaving_To_Charter) as LeavingCharter, sum(ComingIn) as coming
from race_enroll_analysis
WHERE METRO7COUNTY='yes'
group by DISTRICTID, DISTRICTNAME, LOCATION, datayear, studentgroup

select DISTRICTID, DISTRICTNAME,  sum(enrolled) as RaceTotalEnrolled, sum(Leaving_To_Trad) as leavingTrad,
sum(Leaving_To_Charter) as LeavingCharter, sum(ComingIn) as coming
from race_enroll_analysis
WHERE METRO7COUNTY='yes' and datayear='16-17'
group by DISTRICTID, DISTRICTNAME


select studentgroup, sum(countofstudentsenrolled)
from openenroll_byrace
where districtnumber='0625' and datayear='05-06'


delete
from openenroll
where datayear='15-16'


select residentdistrictname, sum(countofstudentsenrolled)
from openenroll
where datayear='15-16'
group by residentdistrictname

select *
from openenroll
where datayear='16-17'

update openenroll set districtid=concat(districtnumber,'-',districttype,'-000') where districtid is null;
update openenroll set residentdistrictid=concat(residentdistrictnumber,'-',residentdistricttype,'-000') where residentdistrictid is null;



select residentdistrictid, residentdistrictname, sum(countofstudentsenrolled)
from openenroll
where datayear='16-17'
group by residentdistrictid,residentdistrictname
order by 2 

select districtname, sum(CountOfStudentsEnrolled)
from openenroll_byrace
where residentdistrictname like 'brooklyn center%' and datayear='16-17'
group by districtname
order by 2 desc

select districtid, sum(CountOfStudentsEnrolled) as ComingIN
from openenroll
where datayear='16-17'
group by districtid

select datayear, sum(CountOfStudentsEnrolled)
from openenroll_byrace
where charterflag='trad' and residentdistrictid='0625-01-000'
group by datayear	


select subject, sum(counttested), sum(countlevel3), sum(countlevel4)
from mca
where datayear='15-16' and districtnumber='0001' and districttype='03' and schoolnumber='000'
and filtered='N' and reportorder='5'
group by subject



select *
from race_enroll_analysis
limit 100


select datayear, sum(countofstudentsenrolled) as OpenEnroll
from openenroll
group by datayear
order by 1

select * 
from openenroll
where datayear='14-15'

update openenroll set districtid=concat(trim(districtnumber),'-',trim(districttype),'-000');
update openenroll set residentdistrictid=concat(trim(residentdistrictnumber),'-',trim(residentdistricttype),'-000');

delete from openenroll where datayear like 'end%'

select distinct residentdistrictid, residentdistrictname
from openenroll
where residentdistrictid not in
(select IDnumber from DistrictList)

update openenroll set residentdistrictid=trim(residentdistrictid)


update DistrictList set districtid=trim(IDnumber)

alter table openenroll
add column location varchar(50)

update openenroll
inner join DistrictList on DistrictList.IDnumber=openenroll.residentdistrictid
set openenroll.location=DistrictList.location

select residentdistrictname, location, count(*)
from openenroll
where location is null
group by residentdistrictname, location
order by 1

select *
from DistrictList
where county='Isanti'

update openenroll set location='OUT STATE' where location is null

select *
from openenroll
where location is null

select datayear,  sum(countofstudentsenrolled)
from openenroll
where location='OUT STATE'
group by datayear

delete from openenroll where datayear like 'end%'

select *
from enroll_race
limit 100


alter table enroll_race_district
add column location varchar(50);


update enroll_race_district
inner join DistrictList on DistrictList.IDnumber=enroll_race_district.districtid
set enroll_race_district.location=DistrictList.location
where enroll_race_district.location is null


select DistrictCountyName,  count(*)
from enroll_race_district
where location is NULL
group by DistrictCountyName

update enroll_race_district set location='SUBURBS' where location is null and (DistrictCountyName='Anoka'
or DistrictCountyName='Carver' or DistrictCountyName='Dakota' or DistrictCountyName='Scott' or DistrictCountyName='Washington')
;

update enroll_race_district set location='OUT STATE' where location is null and 
(DistrictCountyName='Big Stone' or DistrictCountyName='Brown' or DistrictCountyName='Cass' or DistrictCountyName='Crow Wing'
or DistrictCountyName='Douglas' or DistrictCountyName='Goodhue' or DistrictCountyName='lac qui Parle' 
or DistrictCountyName='Le Sueur' or DistrictCountyName='Lincoln' or DistrictCountyName='Lyon'
or DistrictCountyName='McLeod' or DistrictCountyName='Nobles' or DistrictCountyName='Olmsted'
or DistrictCountyName='Pine' or DistrictCountyName='pipestone' or DistrictCountyName='Pope'
or DistrictCountyName='Rice' or DistrictCountyName='St. Louis' or DistrictCountyName='Stearns'
or DistrictCountyName='Steele' or DistrictCountyName='Stevens' or DistrictCountyName='Wabasha' or DistrictCountyName='Winona')

select distinct  enroll_race_district.districttype, districtname, districtcountyname, county, physicalcity
from enroll_race_district left join listofschools_districts on enroll_race_district.districtid=listofschools_districts.idnumber
where location is NULL and districtcountyname is  null and  enroll_race_district.districttype='07'

update enroll_race_district set location='SUBURBS' where districtname='Discovery Charter School' and location is null;
update enroll_race_district set location='SUBURBS' where districtname='North Metro Flex Academy' and location is null;
update enroll_race_district set location='SUBURBS' where districtname='Southwest Metro Intermediate' and location is null;
update enroll_race_district set location='OUT STATE' where districtname='Athlos Academy of Saint Cloud' and location is null;

update enroll_race_district set location='OUT STATE' where location is null and  districtcountyname is  null and  enroll_race_district.districttype='01'


select *
from listofschools_districts

select datayear, sum(TotalStudents)
from enroll_race_district
group by datayear

select datayear, districtid, count(*)
from enroll_race_district
group by datayear, districtid
order by 3 desc


select districtid, datayear, count(*)
from enroll_race_district
where districtid='6013-61-000' 
or districtid='4020-07-000' or districtid='6069-62-000' or districtid='6014-61-000'
or districtid='4064-07-000' or districtid='4008-07-000' or districtid='4020-07-000'
group by districtid, datayear
having count(*)>1

select *
from enroll_race_district
where districtNumber='4008' and datayear='99-00'



create table fixenroll
select datayear, districtnumber, districttype, districtname, grade, districtid, location, sum(ami_male) as ami_male, sum(ami_female) as ami_female,
sum(asi_male) as asi_male, sum(asi_female) as asi_female, sum(blk_male) as blk_male, sum(blk_female) as blk_female,
sum(his_male) as his_male, sum(his_female) as his_female, sum(hpi_male) as hpi_male, sum(hpi_female) as hpi_female,
sum(wht_male) as wht_male, sum(wht_female) as wht_female, sum(totalmale) as totalmale, sum(totalfemale) as totalfemale,
suM(totalminority) as totalminority, sum(totalstudents) as totalstudents, sum(amIndian) as amIndian, sum(Asian) as Asian,
sum(Black) as black, sum(white) as white, sum(hispanic) as hispanic
from enroll_race_district
where districtid='4008-07-000' and datayear='99-00'

insert into fixenroll(datayear, districtnumber, districttype, districtname, grade, districtid, location,  ami_male,  ami_female,
asi_male, asi_female,  blk_male,  blk_female,
 his_male,  his_female,  hpi_male,  hpi_female,
 wht_male, wht_female,  totalmale,  totalfemale,
 totalminority,  totalstudents,amIndian, Asian,
 black,  white,  hispanic)
select datayear, districtnumber, districttype, districtname, grade, districtid, location, sum(ami_male) as ami_male, sum(ami_female) as ami_female,
sum(asi_male) as asi_male, sum(asi_female) as asi_female, sum(blk_male) as blk_male, sum(blk_female) as blk_female,
sum(his_male) as his_male, sum(his_female) as his_female, sum(hpi_male) as hpi_male, sum(hpi_female) as hpi_female,
sum(wht_male) as wht_male, sum(wht_female) as wht_female, sum(totalmale) as totalmale, sum(totalfemale) as totalfemale,
suM(totalminority) as totalminority, sum(totalstudents) as totalstudents, sum(amIndian) as amIndian, sum(Asian) as Asian,
sum(Black) as black, sum(white) as white, sum(hispanic) as hispanic
from enroll_race_district



---------------
delete from enroll_race_district
where districtid='4020-07-000' and datayear='00-01'
;
delete from enroll_race_district
where districtid='6069-62-000' and datayear='00-01'
;
delete from enroll_race_district
where districtid='4020-07-000' and datayear='99-00'
;
delete from enroll_race_district
where districtid='4064-07-000' and datayear='01-02'
;
delete from enroll_race_district
where districtid='6013-61-000' and datayear='99-00'
;
delete from enroll_race_district
where districtid='6014-61-000' and datayear='00-01'


select *
from fixenroll

insert into enroll_race_district(datayear, districtnumber, districttype, districtname, grade, districtid, location,  ami_male,  ami_female,
asi_male, asi_female,  blk_male,  blk_female,
 his_male,  his_female,  hpi_male,  hpi_female,
 wht_male, wht_female,  totalmale,  totalfemale,
 totalminority,  totalstudents,amIndian, Asian,
 black,  white,  hispanic)
select datayear, districtnumber, districttype, districtname, grade, districtid, location,  ami_male,  ami_female,
asi_male, asi_female,  blk_male,  blk_female,
 his_male,  his_female,  hpi_male,  hpi_female,
 wht_male, wht_female,  totalmale,  totalfemale,
 totalminority,  totalstudents,amIndian, Asian,
 black,  white,  hispanic
from fixenroll


select *
from enroll_race
limit 100

select datayear, sum(grandtotal)
from enroll_race
where districttype='07'
group by datayear
order by 1


select schoolid, count(*)
from enroll_race
where districttype='07' and datayear='16-17'
group by schoolid
order by 2 desc

select districtnumber, count(*)
from enroll_race
where datayear='16-17' and districttype='07'
group by districtnumber

select *
from enroll_race_district
where datayear='16-17' and districttype='07'

select districtname, count(*)
from race_district_2017
where districttype='07'
group by districtname


select districtid, districtnumber, districttype, districtname, count(*)
from enroll_race_district
where location is  null and districttype<>'07'
group by districtid, districtnumber, districttype, districtname
order by 1

update enroll_race_district set location='SUBURBS' where districtid='0288-06-000' or districtid='6065-62-000'
or districtid='0930-53-000'
; 

update enroll_race_district set location='OUT STATE' where location is  null and districttype<>'07'

select districtid, districtnumber, districttype, districtname, count(*)
from enroll_race_district
where location is  null
group by districtid, districtnumber, districttype, districtname
order by 1

select *
from enroll_race
where districtname like '%academy%' and schoolyear='1995'





select *
from enroll_race_district
limit 100

select *
from enroll_race_district
where location is null AND DISTRICTCOUNTYNAME IS NULL


update enroll_race_district set location='OUT STATE' where location is null and districtcountyname='Redwood'

create table lkup_county
SELECT DistrictCountyNumber, DistrictCountyName
from enroll_race_district
where districtcountyname is not NULL
group by DistrictCountyNumber, DistrictCountyName


update enroll_race_district 
inner join lkup_county on enroll_race_district.districtcountynumber=lkup_county.districtcountynumber
set enroll_race_district.districtcountyname=lkup_county.districtcountyname
where enroll_race_district.districtcountyname is NULL


select districtcountyname, count(*)
from enroll_race_district
where location is NULL and (districtcountyname<>'Hennepin' and districtcountyname<>'Ramsey')
group by districtcountyname

update enroll_race_district set location='OUT STATE' where location is NULL and (districtcountyname<>'Hennepin' and districtcountyname<>'Ramsey')


select DISTRICTID, districtcountyname, districtname, count(*)
from enroll_race_district
where location is NULL
group by DISTRICTID, districtcountyname, districtname
ORDER BY DISTRICTNAME

SELECT *
FROM enroll_race_district
WHERE DISTRICTID='4019-07-000'

select *
from temp_charterlocations

update enroll_race_district 
inner join temp_charterlocations on enroll_race_district.districtid=temp_charterlocations.districtid
set enroll_race_district.location=temp_charterlocations.location
where enroll_race_district.location is NULL 
;

update enroll_race_district set districtcountyname='STEARNS' where districtid='4114-07-000';
update enroll_race_district set districtcountyname='DAKOTA' where districtid='4221-07-000';
update enroll_race_district set districtcountyname='MCLEOD' where districtid='4240-07-000';

update enroll_race_district set districtcountyname='RAMSEY' where districtid='4243-07-000';
update enroll_race_district set districtcountyname='HENNEPIN' where districtid='4249-07-000';
update enroll_race_district set districtcountyname='HENNEPIN' where districtid='4232-07-000';
update enroll_race_district set districtcountyname='RAMSEY' where districtid='4248-07-000';


SELECT DATAYEAR, SUM(IF(LOCATION='CORE CITIES', TotalStudents,0)) as CoreCities,
sum(if(location='SUBURBS', TotalStudents,0)) as Burbs, sum(if(location='OUT STATE', TotalStudents,0)) as OutState
from enroll_race_district
group by datayear
order by 1

select *
from enroll_race
limit 100

insert into enroll_race_district(datayear, districtnumber, districttype, districtname, districtid, amIndian, Asian, Hispanic, Black, White, TotalStudents)
select datayear, districtnumber,districttype,  districtname, concat(districtnumber,'-',districttype,'-000') as districtid, sum(ami_tot) as amIndian, sum(asi_tot) as Asian,
sum(His_tot) as Hispanic, sum(blk_tot) as Black, sum(wht_tot) as White, sum(GrandTotal) as TotalStudents
from enroll_race
where schoolyear='1991' or schoolyear='1992' or schoolyear='1993' or schoolyear='1994' or schoolyear='1995' or 
schoolyear='1996' or schoolyear='1997' or schoolyear='1998' or schoolyear='1999'
group by datayear, districtnumber,districttype,  concat(districtnumber,'-',districttype,'-000')

create table district_locations
select distinct districtid, location
from enroll_race_district
where location is not NULL


update enroll_race_district 
inner join district_locations on enroll_race_district.districtid=district_locations.districtid
set enroll_race_district.location=district_locations.location
where enroll_race_district.location is null


select distinct districtname
from enroll_race_district
where location is null 

update enroll_race_district set districtname=trim(districtname)

update enroll_race_district set location='CORE CITIES' where districtid='4010-07-000' and location is NULL;
update enroll_race_district set location='OUT STATE' where districtid='4009-07-000' OR DISTRICTID='4013-07-000';

update enroll_race_district set location='OUT STATE' where location is null and districtname like 'academy%';

update enroll_race_district set location='OUT STATE' where location is null


delete from district_locations

insert into district_locations(districtid, location)
select distinct districtid, location
from enroll_race_district

SELECT DATAYEAR, SUM(IF(LOCATION='CORE CITIES', TotalStudents,0)) as CoreCities,
sum(if(location='SUBURBS', TotalStudents,0)) as Burbs, sum(if(location='OUT STATE', TotalStudents,0)) as OutState
from enroll_race_district
group by datayear
order by 1

select *
from race_enroll_analysis
limit 100

select datayear, sum(if(location='CORE CITIES', Leaving_to_charter,0)) as Core_charter, SUM(IF(LOCATION='SUBURBS', leaving_to_charter,0)) as Burbs_charter,
sum(if(location='OUT STATE', leaving_to_charter,0)) as Out_charter
from race_enroll_analysis
group by DataYear




select datayear, studentgroup, sum(case when charterflag='charter' then countofstudentsenrolled else null end) as Charter, 
sum(case when charterflag='trad' then countofstudentsenrolled else null end) as Traditional
from openenroll_byrace
where residentdistrictid='0001-03-000'
group by datayear, studentgroup


select districtname, sum(countofstudentsenrolled) 
from openenroll_byrace
where residentdistrictid='0001-03-000' and datayear='16-17' and charterflag='charter'
group by districtname
order by 2 desc


select *
from enroll_race_district
limit 100

select yr, location, count(*)
from enroll_race_district
where districttype='07'
group by yr, location

select enroll_race_district.districtid, organization, enroll_race_district.location, yr,  sum(TotalStudents)
from enroll_race_district left join DistrictList on enroll_race_district.districtid=DistrictList.IDNumber
where (enroll_race_district.districttype='01' or enroll_race_district.districttype='03') and enroll_race_district.location='Suburbs'
group by enroll_race_district.districtid, enroll_race_district.location, yr

select * 
from DistrictList 
where idnumber='0272-01-000'
or idnumber='0200-01-000'
or idnumber='0191-01-000'
or idnumber='0831-01-000'
or idnumber='0270-01-000'
or idnumber='0015-01-000'


select datayear, districtname, location, sum(enrolled) as Enrolled, sum(Leaving_to_Trad)+Sum(Leaving_to_Charter) as Leaving,
sum(ComingIn) as ComingIn
from race_enroll_analysis
group by datayear, districtname, location





alter table openenroll_byrace 
add column TotalEnroll INT

update openenroll_byrace a
inner join enroll_race_district b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalEnroll=b.White
where a.studentgroup='White'

;
update openenroll_byrace a
inner join enroll_race_district b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalEnroll=b.AmIndian
where a.studentgroup='AMERICAN INDIAN'
;

update openenroll_byrace a
inner join enroll_race_district b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalEnroll=b.Black
where a.studentgroup='Black'
;

update openenroll_byrace a
inner join enroll_race_district b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalEnroll=b.Asian
where a.studentgroup='Asian'

;

update openenroll_byrace a
inner join enroll_race_district b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalEnroll=b.Hispanic
where a.studentgroup='Hispanic'
;

select datayear, count(*)
from enroll_special
group by datayear
order by 1


select datayear, residentdistrictid,  metro7county, location, county, DistrictList.Organization as HomeDistName,
sum(case when StudentGroup='White' then CountOfStudentsEnrolled else 0 end) as Wht,
sum(case when StudentGroup='American Indian' then CountOfStudentsEnrolled else 0 end) as AmInd,
sum(case when StudentGroup='Black' then CountOfStudentsEnrolled else 0 end) as Blk,
sum(case when StudentGroup='Asian' then CountOfStudentsEnrolled else 0 end) as Asn,
sum(case when StudentGroup='Hispanic' then CountOfStudentsEnrolled else 0 end) as Hisp, 
Sum(CountOfStudentsEnrolled) as TotalLeaving
from openenroll_byrace left join DistrictList on openenroll_byrace.residentdistrictid=DistrictList.IDNumber
group by datayear, residentdistrictid,  metro7county, location, county, DistrictList.Organization

delete
from enroll_special 
where datayear=''

select datayear, grade, count(*)
from enroll_special
where grade is null or grade=''
group by datayear, grade

update enroll_special set grade='All grades' WHERE grade is null

select schoolNumber, count(*)
from enroll_special
group by schoolNumber
order by 1

select *
from enroll_special
where datayear='06-07'

select *
from openenroll_bypoverty
limit 100

create view totalleaving_byflow
as
select datayear, residentdistrictid, districtid, residentdistrictname, districtname, sum(countofstudentsenrolled) as KidsCount
from openenroll_byrace
group by datayear, residentdistrictid, districtid, residentdistrictname, districtname

select a.datayear, a.residentdistrictname, a.districtname as goingto, b.residentdistrictname, b.charterdistrictname, frp,nonfrp, kidscount
from totalleaving_byflow a left join openenroll_bypoverty b on a.residentdistrictid=b.districtid
and a.datayear=b.datayear
order by frp

create index idx_residentdistrictid on openenroll_bypoverty(residentdistrictid);
create index idx_districtid on openenroll_bypoverty(districtid);
create index idx_datayear on openenroll_bypoverty(datayear);


select *
from openenroll_byrace
where residentdistrictid='0011-01-000' and datayear='00-01' and districtid='4008-07-000'

select fiscalyear, sum(studenttotal)
from openenroll_bypoverty
group by fiscalyear
order by fiscalyear

select *
from openenroll_byrace
limit 10


select datayear, sum(CountOfStudentsEnrolled)
from openenroll_byrace
group by datayear
order by 1


select *
from race_enroll_analysis
limit 100

select datayear,  sum(enrolled), sum(leaving_to_trad), sum(leaving_to_charter), sum(comingin)
from race_enroll_analysis
where location='suburbs'
group by datayear

select *
from mca



create table race_enroll_analysis_v2
select datayear, race_enroll_analysis.districtid, race_enroll_analysis.metro7county, race_enroll_analysis.location, 
race_enroll_analysis.county, DistrictList.Organization as HomeDistName,
sum(case when StudentGroup='White' then Leaving_to_trad else 0 end) as WhtOpenEnroll,
sum(case when StudentGroup='White' then Leaving_To_Charter else 0 end) as WhtCharter,
sum(case when StudentGroup='White' then ComingIn else 0 end) as WhtComingIn,
sum(case when StudentGroup='White' then Enrolled else 0 end) as WhtEnrolled,
sum(case when StudentGroup='American Indian' then Leaving_to_trad else 0 end) as IndOpenEnroll,
sum(case when StudentGroup='American Indian' then Leaving_To_Charter else 0 end) as IndCharter,
sum(case when StudentGroup='American Indian' then ComingIn else 0 end) as IndComingIn,
sum(case when StudentGroup='American Indian' then Enrolled else 0 end) as IndEnrolled,
sum(case when StudentGroup='Black' then Leaving_to_trad else 0 end) as BlkOpenEnroll,
sum(case when StudentGroup='Black' then Leaving_To_Charter else 0 end) as BlkCharter,
sum(case when StudentGroup='Black' then ComingIn else 0 end) as BlkComingIn,
sum(case when StudentGroup='Black' then Enrolled else 0 end) as BlkEnrolled,
sum(case when StudentGroup='Asian' then Leaving_to_trad else 0 end) as AsnOpenEnroll,
sum(case when StudentGroup='Asian' then Leaving_To_Charter else 0 end) as AsnCharter,
sum(case when StudentGroup='Asian' then ComingIn else 0 end) as AsnComingIn,
sum(case when StudentGroup='Asian' then Enrolled else 0 end) as AsnEnrolled,
sum(case when StudentGroup='Hispanic' then Leaving_to_trad else 0 end) as HspOpenEnroll,
sum(case when StudentGroup='Hispanic' then Leaving_To_Charter else 0 end) as HspCharter,
sum(case when StudentGroup='Hispanic' then ComingIn else 0 end) as HspComingIn,
sum(case when StudentGroup='Hispanic' then Enrolled else 0 end) as HspEnrolled
from race_enroll_analysis left join DistrictList on race_enroll_analysis.districtid=DistrictList.IDNumber
group by datayear, race_enroll_analysis.districtid, race_enroll_analysis.metro7county, race_enroll_analysis.location, 
race_enroll_analysis.county, DistrictList.Organization 


select districttype, count(*)
from openenroll
group by districttype
order by 1

create view temp_comingin 
as
select datayear, districtid, sum(countofstudentsenrolled) as ComingIn
from openenroll
group by datayear, districtid

;
create view temp_leavingOE
as
select datayear, residentdistrictid, sum(countofstudentsenrolled) as LeavingOpenEnroll
from openenroll
group by datayear, residentdistrictid

select *
from race_enroll_analysis_v2
where districtid like '0001-03%'

select HomeDistName, count(*)
from race_enroll_analysis_v2
group by HomeDistName





select *
from race_enroll_analysis_v2
where districtid='0001-03-000'
order by datayear

update race_enroll_analysis_v2 set TotalEnroll=whtenrolled+indenrolled+blkenrolled+asnenrolled+hspenrolled
;









select Homedistname, count(*)
from race_enroll_analysis_v2
where keep is null
group by homedistname
order by 2

select *
from race_enroll_analysis_v2
where homedistname like 'red rock%'

select *
from race_enroll_analysis
where districtname like 'goodhue%'




create table race_enroll_analysis_v2
select datayear, residentdistrictid,  metro7county, location, county, DistrictList.Organization as HomeDistName,
sum(case when StudentGroup='White' then CountOfStudentsEnrolled else 0 end) as WhtLeaving,
sum(case when StudentGroup='American Indian' then CountOfStudentsEnrolled else 0 end) as AmIndLeaving,
sum(case when StudentGroup='Black' then CountOfStudentsEnrolled else 0 end) as BlkLeaving,
sum(case when StudentGroup='Asian' then CountOfStudentsEnrolled else 0 end) as AsnLeaving,
sum(case when StudentGroup='Hispanic' then CountOfStudentsEnrolled else 0 end) as HispLeaving
from openenroll_byrace left join DistrictList on openenroll_byrace.residentdistrictid=DistrictList.IDNumber
group by datayear, residentdistrictid,  metro7county, location, county, DistrictList.Organization


create view temp_districts1617
AS
select residentdistrictid
from race_enroll_analysis_v2
where datayear='16-17'
group by residentdistrictid

alter table race_enroll_analysis_v2
add column keep varchar(1);

update race_enroll_analysis_v2 a
inner join temp_districts1617 b on a.residentdistrictid=b.residentdistrictid
set keep='y'

select homedistname, count(*)
from race_enroll_analysis_v2
where keep is null
group by homedistname
order by 2

delete
from race_enroll_analysis_v2 where homedistname is null;

delete from race_enroll_analysis_v2 where keep is null

select *
from race_enroll_analysis_v2
limit 100


alter table race_enroll_analysis_v2
add column TotalCharter int,
add column TotalOpenEnroll int,
add column TotalComingIn int,
add column residents int,
add column totalenroll int,
add column whtenroll int,
add column amIndenroll int,
add column blkenroll int,
add column asnenroll int,
add column hispenroll INT


update race_enroll_analysis_v2 a
inner join temp_leavingOE b on a.residentdistrictid=b.residentdistrictid and a.datayear=b.datayear
set a.TotalOpenEnroll=b.LeavingOpenEnroll;

update race_enroll_analysis_v2 a
inner join temp_comingin b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalComingIn=b.ComingIn;


select *
from enroll_race_district
limit 100

update race_enroll_analysis_v2 a
inner join enroll_race_district b on a.datayear=b.datayear and a.residentdistrictid=b.districtid
set whtenroll=white, amIndenroll=amIndian, blkenroll=black, asnenroll=Asian, hispenroll=Hispanic,
totalenroll=TotalStudents

select *
from race_enroll_analysis_v2
limit 100

create view temp_leavingforCharter
as
select datayear, residentdistrictid, sum(countofstudentsenrolled) as TotCharter
from openenroll_byrace
where charterflag='charter'
group by datayear, residentdistrictid

update race_enroll_analysis_v2 a
inner join temp_leavingforCharter b on a.datayear=b.datayear and a.residentdistrictid=b.residentdistrictid
set a.TotalCharter=TotCharter



update race_enroll_analysis_v2 set TotalOpenEnroll=0 where TotalOpenEnroll is null;
update race_enroll_analysis_v2 set TotalCharter=0 where TotalCharter is null;
update race_enroll_analysis_v2 set TotalComingIn=0 where TotalComingIn is null;

update race_enroll_analysis_v2 set Residents = (TotalEnroll-TotalComingIn)+TotalOpenEnroll+TotalCharter

select *
from race_enroll_analysis_v2
where residentdistrictid='0001-03-000'
order by datayear


create view temp_ComingInByRace
as
select datayear, districtid,  
sum(case when StudentGroup='White' then CountOfStudentsEnrolled else 0 end) as WhtComingIn,
sum(case when StudentGroup='American Indian' then CountOfStudentsEnrolled else 0 end) as AmIndComingIn,
sum(case when StudentGroup='Black' then CountOfStudentsEnrolled else 0 end) as BlkComingIn,
sum(case when StudentGroup='Asian' then CountOfStudentsEnrolled else 0 end) as AsnComingIn,
sum(case when StudentGroup='Hispanic' then CountOfStudentsEnrolled else 0 end) as HispComingIn
from openenroll_byrace 
where districttype<>'07'
group by datayear, districtid

alter table race_enroll_analysis_v2 
add column WhtComingIn int,
add column AmIndComingIn int,
add column BlkComingIn int,
add column AsnComingIn int,
add column HispComingIn int

update race_enroll_analysis_v2 a
inner join temp_ComingInByRace b 
on a.datayear=b.datayear and a.residentdistrictid=b.districtid
set a.whtComingIn=b.whtComingin,
a.AmIndComingIn = b.AmIndComingin,
a.BlkComingIn=b.Blkcomingin,
a.asncomingin=b.asncomingin,
a.hispcomingin=b.hispcomingin


select *
from race_enroll_analysis_v2
limit 100

update race_enroll_analysis_v2 set whtcomingin=0 where whtcomingin is null;
update race_enroll_analysis_v2 set amindcomingin=0 where amindcomingin is null;
update race_enroll_analysis_v2 set blkcomingin=0 where blkcomingin is null;
update race_enroll_analysis_v2 set asncomingin=0 where asncomingin is null;
update race_enroll_analysis_v2 set hispcomingin=0 where hispcomingin is null;





alter table race_enroll_analysis_v2 
add column WhtResidents int,
add column AmIndResidents int,
add column BlkResidents int,
add column AsnResidents int,
add column HispResidents int;

update race_enroll_analysis_v2 set whtresidents=(whtenroll-whtcomingin)+whtleaving;
update race_enroll_analysis_v2 set amIndResidents=(AmIndenroll-AmIndcomingin)+AmIndleaving;
update race_enroll_analysis_v2 set blkresidents=(blkenroll-blkcomingin)+blkleaving;
update race_enroll_analysis_v2 set asnresidents=(asnenroll-asncomingin)+asnleaving;
update race_enroll_analysis_v2 set hispresidents=(hispenroll-hispcomingin)+hispleaving;



create table race_enroll_analysis_v3
select datayear, residentdistrictid,  metro7county, location, county, DistrictList.Organization as HomeDistName,
sum(case when StudentGroup='White' then CountOfStudentsEnrolled else 0 end) as WhtLeaving,
sum(case when StudentGroup='American Indian' then CountOfStudentsEnrolled else 0 end) as AmIndLeaving,
sum(case when StudentGroup='Black' then CountOfStudentsEnrolled else 0 end) as BlkLeaving,
sum(case when StudentGroup='Asian' then CountOfStudentsEnrolled else 0 end) as AsnLeaving,
sum(case when StudentGroup='Hispanic' then CountOfStudentsEnrolled else 0 end) as HispLeaving
from openenroll_byrace left join DistrictList on openenroll_byrace.residentdistrictid=DistrictList.IDNumber
group by datayear, residentdistrictid,  metro7county, location, county, DistrictList.Organization;





alter table race_enroll_analysis_v3
add column TotalCharter int,
add column TotalOpenEnroll int,
add column TotalComingIn int,
add column residents int,
add column totalenroll int,
add column whtenroll int,
add column amIndenroll int,
add column blkenroll int,
add column asnenroll int,
add column hispenroll INT,
add column WhtComingIn int,
add column AmIndComingIn int,
add column BlkComingIn int,
add column AsnComingIn int,
add column HispComingIn int,
add column WhtResidents int,
add column AmIndResidents int,
add column BlkResidents int,
add column AsnResidents int,
add column HispResidents int;



update race_enroll_analysis_v3 a
inner join temp_leavingOE b on a.residentdistrictid=b.residentdistrictid and a.datayear=b.datayear
set a.TotalOpenEnroll=b.LeavingOpenEnroll;

update race_enroll_analysis_v3 a
inner join temp_comingin b on a.residentdistrictid=b.districtid and a.datayear=b.datayear
set a.TotalComingIn=b.ComingIn;



update race_enroll_analysis_v3 a
inner join enroll_race_district b on a.datayear=b.datayear and a.residentdistrictid=b.districtid
set whtenroll=white, amIndenroll=amIndian, blkenroll=black, asnenroll=Asian, hispenroll=Hispanic,
totalenroll=TotalStudents;



update race_enroll_analysis_v3 a
inner join temp_leavingforCharter b on a.datayear=b.datayear and a.residentdistrictid=b.residentdistrictid
set a.TotalCharter=TotCharter;



update race_enroll_analysis_v3 set TotalOpenEnroll=0 where TotalOpenEnroll is null;
update race_enroll_analysis_v3 set TotalCharter=0 where TotalCharter is null;
update race_enroll_analysis_v3 set TotalComingIn=0 where TotalComingIn is null;

update race_enroll_analysis_v3 set Residents = (TotalEnroll-TotalComingIn)+TotalOpenEnroll+TotalCharter;




update race_enroll_analysis_v3 a
inner join temp_ComingInByRace b 
on a.datayear=b.datayear and a.residentdistrictid=b.districtid
set a.whtComingIn=b.whtComingin,
a.AmIndComingIn = b.AmIndComingin,
a.BlkComingIn=b.Blkcomingin,
a.asncomingin=b.asncomingin,
a.hispcomingin=b.hispcomingin;



update race_enroll_analysis_v3 set whtcomingin=0 where whtcomingin is null;
update race_enroll_analysis_v3 set amindcomingin=0 where amindcomingin is null;
update race_enroll_analysis_v3 set blkcomingin=0 where blkcomingin is null;
update race_enroll_analysis_v3 set asncomingin=0 where asncomingin is null;
update race_enroll_analysis_v3 set hispcomingin=0 where hispcomingin is null;


update race_enroll_analysis_v3 set whtresidents=(whtenroll-whtcomingin)+whtleaving;
update race_enroll_analysis_v3 set amIndResidents=(AmIndenroll-AmIndcomingin)+AmIndleaving;
update race_enroll_analysis_v3 set blkresidents=(blkenroll-blkcomingin)+blkleaving;
update race_enroll_analysis_v3 set asnresidents=(asnenroll-asncomingin)+asnleaving;
update race_enroll_analysis_v3 set hispresidents=(hispenroll-hispcomingin)+hispleaving;



select *
from race_enroll_analysis_v3
limit 1000

select datayear, sum(TotalCharter) as Charter, sum(TotalOpenEnroll) as OE, sum(residents) as Rez
from race_enroll_analysis_v3
where location='OUT STATE'
group by datayear
order by 1


#################################################



select fiscalyear, count(*)
from openenroll_bypoverty_v2
group by fiscalyear

select *
from enroll_special
limit 100

create view district_freelunch
as
select datayear, concat(trim(districtnumber),'-',trim(districttype), '-000') as districtid,  sum(k12enr) as TotEnroll, sum(freek12)+sum(redk12) as freelunch
from enroll_special
where grade='All grades'
group by datayear , concat(trim(districtnumber),'-',trim(districttype), '-000')

alter table openenroll_bypoverty_v2
add column datayear varchar(10)


update openenroll_bypoverty_v2 set datayear='97-98' where fiscalyear='1998';
update openenroll_bypoverty_v2 set datayear='98-99' where fiscalyear='1999';
update openenroll_bypoverty_v2 set datayear='99-00' where fiscalyear='2000';
update openenroll_bypoverty_v2 set datayear='00-01' where fiscalyear='2001';
update openenroll_bypoverty_v2 set datayear='01-02' where fiscalyear='2002';
update openenroll_bypoverty_v2 set datayear='02-03' where fiscalyear='2003';
update openenroll_bypoverty_v2 set datayear='03-04' where fiscalyear='2004';
update openenroll_bypoverty_v2 set datayear='04-05' where fiscalyear='2005';
update openenroll_bypoverty_v2 set datayear='05-06' where fiscalyear='2006';
update openenroll_bypoverty_v2 set datayear='06-07' where fiscalyear='2007';
update openenroll_bypoverty_v2 set datayear='07-08' where fiscalyear='2008';
update openenroll_bypoverty_v2 set datayear='08-09' where fiscalyear='2009';
update openenroll_bypoverty_v2 set datayear='09-10' where fiscalyear='2010';
update openenroll_bypoverty_v2 set datayear='10-11' where fiscalyear='2011';
update openenroll_bypoverty_v2 set datayear='11-12' where fiscalyear='2012';
update openenroll_bypoverty_v2 set datayear='12-13' where fiscalyear='2013';
update openenroll_bypoverty_v2 set datayear='13-14' where fiscalyear='2014';
update openenroll_bypoverty_v2 set datayear='14-15' where fiscalyear='2015';
update openenroll_bypoverty_v2 set datayear='15-16' where fiscalyear='2016';
update openenroll_bypoverty_v2 set datayear='16-17' where fiscalyear='2017';


select a.*, b.TotEnroll, b.FreeLunch
from openenroll_bypoverty_v2 a left join district_freelunch b on a.datayear=b.datayear and a.ResidentDistrictID=b.districtid
where fiscalyear>'2001'

select idnumber, location
from DistrictList

SELECT *
FROM enroll_special
where districtname like '%prinsburg%'


select residentdistrictname, fiscalyear, sum(frp_sum), sum(nonfrp_sum), sum(totalstudents)
from openenroll_bypoverty_v2 inner join DistrictList on openenroll_bypoverty_v2.residentdistrictid=DistrictList.IDNumber
where metro7county='yes' and fiscalyear='2017'
group by residentdistrictname, fiscalyear

select *
from openenroll_bypoverty
limit 100


select datayear, homedistname, TotalComingIn
from race_enroll_analysis_v2
where residentDistrictid='0625-01-000' or residentDistrictid='0001-03-000'


select datayear, sum(countofstudentsenrolled) as ComingIn
from openenroll
where districtid='0001-03-000'
group by datayear

select *
from enroll_race_district
where datayear='16-17'
order by TotalStudents desc


select datayear, count(*)
from enroll_race
group by datayear
order by 1 desc


select schoolname, datayear, reportdescription, subject, grade, averagescore, stddev, counttested, 
countlevel1, countlevel2, countlevel3, countlevel4, filtered, gradeenrollment
from mca
where schoolid='0001-03-000' and subject='M' and reportorder='5'   and summarylevel='district'
order by datayear


select *
from enroll_race
where schoolyear='2017' and districtnumber='0625'


select districtid, datayear, sum(countofstudentsenrolled)
from openenroll
where districtid='0625-01-000' 
group by DistrictID, datayear

select *
from race_enroll_analysis_v3
limit 100

select datayear, TotalCharter, TotalEnroll, TotalOpenEnroll
from race_enroll_analysis_v3
where residentdistrictid='0001-03-000' 
 


select schoolname, datayear, reportdescription, subject, grade, averagescore, stddev, counttested, 
countlevel1, countlevel2, countlevel3, countlevel4, filtered
from mca
where schoolid='0625-01-000' and subject='M' and reportorder='5'   and summarylevel='district'
order by datayear


select *
from mca
where datayear='16-17'
limit 100

select schoolid, districtname, datayear, reportdescription, subject, grade, averagescore, stddev, counttested, 
countlevel1, countlevel2, countlevel3, countlevel4, filtered, gradeenrollment
from mca inner join DistrictList on mca.schoolid=DistrictList.IDNumber
where subject='M' and grade='06' and reportorder='1'   and summarylevel='district' and filtered='N'
and metro7county='yes' and datayear='16-17'
order by datayear


select datayear, sum(whtleaving), sum(AmIndLeaving), sum(Blkleaving), sum(asnleaving), sum(hispleaving), sum(TotalCharter),
sum(TotalOpenEnroll), 0 as PctLeavingToCharter, 0 as PctLeavingOpenEnroll, sum(TotalComingIn), sum(residents), sum(totalenroll), 
sum(whtenroll), sum(amIndenroll), sum(blkenroll), sum(asnenroll), sum(hispenroll), sum(whtcomingin), sum(amIndcomingin),
sum(blkcomingin), sum(asncomingin), sum(hispcomingin), sum(whtresidents), sum(amindresidents),
sum(blkresidents), sum(asnresidents), sum(hispresidents)
from race_enroll_analysis_v3
group by datayear


select *
from race_enroll_analysis_v3


select schoolname, datayear, k12enr, freek12, redk12, lepservedk12, lepidentifiedk12
from enroll_special
where schoolid like '0001-03%'  and grade='all grades' and schoolname like 'bethune%'
order by datayear

select *
from enroll_special
limit 100

select *
from openenroll_byrace
where residentdistrictnumber='0625' and studentgroup='AMERICAN INDIAN'
order by datayear






select summarylevel, count(*)
from mca
group by summarylevel


select districtnumber, districttype, schoolname,  count(*)
from mca
where summarylevel='' 
group by districtnumber, districttype, schoolname

update mca set summarylevel='state' where districtnumber='9999' and districttype='99' and schoolnumber='000';
update mca set summarylevel='economicDevRegion' where districtnumber='8888' and districttype='88' and schoolnumber='000';
update mca set summarylevel='county' where districtnumber='7777' and districttype='77' and schoolnumber='000';

update mca set summarylevel='district' where summarylevel='' and schoolnumber='000';
update mca set summarylevel='school' where summarylevel=''


select summarylevel, count(*)
from mca
where districttype='61'
group by summarylevel



select districtname, datayear, countofstudentsenrolled
from openenroll_byrace
where residentdistrictnumber='0625' and residentdistricttype='01' 
order by 1,2

update openenroll_byrace set countofstudentsenrolled=300 WHERE 
residentdistrictnumber='0001' and residentdistricttype='03' and studentgroup='ASIAN' and districtname='PRAIRIE SEEDS ACADEMY'
 AND DATAYEAR='08-09'

update race_enroll_analysis_v3
set AsnLeaving=1346, Totalcharter=8106, residents=45466, AsnResidents=4293
where residentdistrictid='0001-03-000' and datayear='08-09'


select *
from mca
limit 100


select schoolid, schoolname, datayear, schoolclassification, reportdescription, subject, sum(counttested) as TotTested, 
sum(countlevel3) as Lev3, sum(countlevel4) as Lev4
from mca
where schoolid like '0001-03%' and subject='M' and reportorder='1'   and summarylevel='school' and filtered='N'
group by schoolid, schoolname, datayear, schoolClassification, reportdescription, subject


select  datayear, reportdescription, subject, sum(counttested) as TotTested, 
sum(countlevel3) as Lev3, sum(countlevel4) as Lev4
from mca
where schoolid='0625-01-000' and subject='R' and reportcategory like 'Race%'  and summarylevel='district' and filtered='N'
group by datayear,  reportdescription, subject


select *
from mca
where schoolid='0001-03-190' and datayear='07-08'


select districtname, sum(countofstudentsenrolled)
from openenroll_byrace
where residentdistrictnumber='0001' and residentdistricttype='03' and charterflag='charter' and datayear='16-17'
group by districtName
order by 2 desc


#What are the racial demographics of charters in Minneapolis versus those in St Paul?

select districtname, totalstudents, amIndian, Asian, Black, white, Hispanic
from enroll_race_district
where location='CORE CITIES' and districttype='07' and datayear='16-17' and address like '%saint paul%'


update enroll_race_district set amIndian=0 where amIndian is null;
update enroll_race_district set Asian=0 where Asian is null;
update enroll_race_district set Black=0 where Black is null;
update enroll_race_district set white=0 where white is null;
update enroll_race_district set Hispanic=0 where Hispanic is null;




#Queries to pull out graphics and check numbers

select districtid, districtname, studentgroup, sum(CountOfStudentsEnrolled)
from openenroll_byrace
where residentdistrictnumber='0625' and datayear='16-17' AND (districtid='4103-07-000'
or districtid='0623-01-000'
or districtid='0622-01-000'
or districtid='4181-07-000'
or districtid='4015-07-000'
or districtid='4098-07-000'
or districtid='4132-07-000')
group by districtid, districtname, studentgroup
order by 1,3

select *
from openenroll_byrace
limit 100

select districtid, districtname, studentgroup, sum(CountOfStudentsEnrolled) 
from openenroll_byrace
where residentdistrictnumber='0001' and residentdistricttype='03' and datayear='16-17' and (districtid='0281-01-000'
or districtid='4170-07-000'
or districtid='4017-07-000'
or districtid='4192-07-000'
or districtid='0013-01-000'
or districtid='0270-01-000')
group by districtid, districtname, studentgroup
order by 1, 3

select districtname, amIndian, Asian, Black, white, Hispanic, TotalStudents
from enroll_race_district
where datayear='16-17' and (districtid='4103-07-000'
or districtid='0623-01-000'
or districtid='0622-01-000'
or districtid='4181-07-000'
or districtid='4015-07-000'
or districtid='4098-07-000'
or districtid='4132-07-000')


select districtname, amIndian, Asian, Black, white, Hispanic, TotalStudents
from enroll_race_district
where datayear='16-17' and (districtid='0281-01-000'
or districtid='4170-07-000'
or districtid='4017-07-000'
or districtid='4192-07-000'
or districtid='0013-01-000'
or districtid='0270-01-000')


select datayear, location, sum(totalstudents), count(*)
from enroll_race_district
where districttype='07'
group by datayear, location

select datayear, sum(case when location='CORE CITIES' then totalstudents else 0 end) as core,
sum(case when location='SUBURBS' then totalstudents else 0 end) as burbs,
sum(case when location='OUT STATE' then totalstudents else 0 end) as outst
from enroll_race_district
where districttype='07'
group by datayear

select *
from mca
limit 100


select schoolid, districtname, datayear, DistrictList.location, DistrictList.county, reportdescription, subject, sum(counttested), sum(countlevel3), sum(countlevel4)
from mca left join DistrictList on mca.schoolid=DistrictList.IDNumber
where datayear='16-17' and filtered='N' and metro7county='yes' and reportorder='5' and summarylevel='district' and subject='M'
group by schoolid, districtname, datayear, DistrictList.location, DistrictList.county, reportdescription, subject



SELECT *
FROM SchoolList
where schoolname like '%best academy%'

select *
from mca
where datayear='16-17' and subject='M' and schoolid='4192-07-000'

select *
from DistrictList
where districtnumber='4192'

select districtid, districtname, sum(CountOfStudentsEnrolled) 
from openenroll_byrace
where studentgroup='BLACK' and residentdistrictid='0001-03-000' and datayear='16-17'
group by districtid, districtname
order by 3 desc


select *
from SchoolList inner join enroll_race on SchoolList.schoolid=enroll_race.schoolid
where location='CORE CITIES' and classification<=40 and (city='Minneapolis' or city is null)
and enroll_race.datayear='16-17'
order by 1

select *
from mca
where schoolid='4017-07-011' and datayear='16-17'


update SchoolList set closed='yes' where schoolid='4203-07-010' or schoolid='4115-07-010' or schoolid='4017-07-011'


select *
from enroll_race_district
where datayear='16-17' and districtname like '%higher ground%'
;
select districtname, sum(countofstudentsenrolled)
from openenroll
where datayear='16-17'  and residentdistrictid='0625-01-000'
group by districtname
order by 2 desc