##This is the script for importing voter registration data from the Minnesota Secretary of State
##It goes into the newsroomdata database on amazon1; table is called "VoterReg_Current"


##STEP 1:
##move the existing data out of VoterReg_current by export a text file ???


##THEN RUN REMAINDER OF SCRIPT
delete from VoterReg_current;

## run imports -- there are 8 files
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter01.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();


##IMPORT 2ND VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter02.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();

##import 3RD VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter03.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();

##IMPORT 4TH VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter04.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();


##IMPORT 5TH VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter05.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();

##IMPORT 6TH VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter06.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();

##IMPORT 7TH VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter07.txt' into table VoterReg_current fields terminated by ',' enclosed by '"'  lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();

##IMPORT 8TH VOTER FILE
LOAD DATA LOCAL INFILE 'W:\\Uniquery_PANDA\\voters\\voter08.txt' into table VoterReg_current fields terminated by ',' enclosed by '"' lines terminated by '\r\n' ignore 1 lines
(@VoterId,
@CountyCode,
@FirstName,
@MiddleName,
@LastName,
@NameSuffix,
@HouseNumber,
@StreetName,
@UnitType,
@UnitNumber,
@Address2,
@City,
@State,
@ZipCode,
@MailAddress,
@MailCity,
@MailState,
@MailZipCode,
@PhoneNumber,
@RegistrationDate,
@DOBYear,
@StateMcdCode,
@McdName,
@PrecinctCode,
@PrecinctName,
@WardCode,
@School,
@SchSub,
@Judicial,
@Legislative,
@StateSen,
@Congressional,
@Commissioner,
@Park,
@SoilWater,
@Hospital,
@LegacyId)
SET
VoterId=@VoterId,
CountyCode=@CountyCode,
FirstName=@FirstName,
MiddleName=@MiddleName,
LastName=@LastName,
NameSuffix=@NameSuffix,
HouseNumber=@HouseNumber,
StreetName=@StreetName,
UnitType=@UnitType,
UnitNumber=@UnitNumber,
Address2=@Address2,
City=@City,
State=@State,
ZipCode=@ZipCode,
MailAddress=@MailAddress,
MailCity=@MailCity,
MailState=@MailState,
MailZipCode=@MailZipCode,
PhoneNumber=@PhoneNumber,
RegistrationDate=STR_TO_DATE(@RegistrationDate, '%Y-%m-%d'),
DOBYear=@DOBYear,
StateMcdCode=@StateMcdCode,
McdName=@McdName,
PrecinctCode=@PrecinctCode,
PrecinctName=@PrecinctName,
WardCode=@WardCode,
School=@School,
SchSub=@SchSub,
Judicial=@Judicial,
Legislative=@Legislative,
StateSen=@StateSen,
Congressional=@Congressional,
Commissioner=@Commissioner,
Park=@Park,
SoilWater=@SoilWater,
Hospital=@Hospital,
LegacyId=@LegacyId,
stribimportdate=NOW();



##POPULATE THE ADDRESS FIELD
update VoterReg_current set Address = CONCAT(Housenumber,' ',trim(streetname),' ',trim(UnitType),' ',trim(UnitNumber)) where Address is null and UnitNumber is not NULL;
update VoterReg_current set Address = CONCAT(Housenumber,' ',trim(streetname)) where Address is null ;


##POPULATE THE COUNTY NAME FIELD
update VoterReg_current a inner join voter_lkup_county b on a.CountyCode=b.TextCountyID
set a.countyname=UPPER(b.countyname);

#UPDATE NEWSROOM INVENTORY to reflect new update date
update newsroomdata.inventory set lastupdate=NOW() where idnumber=1;